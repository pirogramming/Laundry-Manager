{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>세탁 정보 확인</title>
  <link rel="stylesheet" href="{% static 'laundry_manager/style.css' %}">
  <link rel="stylesheet" href="{% static 'laundry_manager/laundry-info-style.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* 멀티라인 텍스트 줄바꿈 보존 */
    .preline { white-space: pre-line; }
  </style>
</head>
<body>
  <div class="page-container">
    <div class="content-wrapper">

      <header class="info-header">
        <nav class="top-nav">
          <a href="{% url 'result' %}">
            <button class="icon-btn"><i class="fa-solid fa-arrow-left"></i></button>
          </a>
          <h1>당신의 세탁 가이드</h1>
        </nav>

        <div class="laundry-item-title">
          <p>세탁물 이름</p>
          <h2>
            {% if info.material %}
              {{ info.material }}
            {% elif material %}
              {{ material.name|default:"" }}
            {% else %}
              (소재 미선택)
            {% endif %}
            {% if info.stains %} / {{ info.stains }}{% endif %}
          </h2>

        </div>
      </header>

      <main class="info-content">

        <!-- 최적 요약 -->
        <section class="card summary-card">
          <h3>
            <img src="https://img.icons8.com/?size=100&id=rYb1JFR9WLSh&format=png&color=2445EF" alt="아이콘" class="ai-icon">
            최적 세탁법 요약
          </h3>

          <div class="icon-info-group">
            <div class="icon-info">
              <h4>1. 세탁법 요약</h4>
              <div class="icon-info-text">
                <i class="fa-solid fa-check-circle check-icon"></i>
                <span class="preline">
                  {% if summary and summary.wash %}{{ summary.wash }}
                  {% elif material.description %}{{ material.description }}
                  {% else %}정보 없음{% endif %}
                </span>
              </div>
            </div>

            <div class="icon-info">
              <h4>2. 건조법 요약</h4>
              <div class="icon-info-text">
                <i class="fa-solid fa-ban ban-icon"></i>
                <span class="preline">
                  {% if summary and summary.dry %}{{ summary.dry }}
                  {% else %}정보 없음{% endif %}
                </span>
              </div>
            </div>
          </div>

          <div class="stain-info">
            <strong>3. 얼룩 제거법 요약 :</strong>
            {% if summary and summary.stain %}
              <p class="stain-kw preline">{{ summary.stain }}</p>
            {% else %}
              <p>정보 없음</p>
            {% endif %}
          </div>
        </section>

<section class="card avoid-card">
  <h3><i class="fa-solid fa-triangle-exclamation"></i> 피해야 하는 세탁법</h3>

  {# 1) 소재 경고 #}
  {% if material and material.warning %}
    <div class="avoid-item">
      <i class="fa-solid fa-circle-exclamation"></i>
      <p class="preline">{{ material.warning }}</p>
    </div>
  {% endif %}

  {# 2) 얼룩 not_to_do / Not_to__do 가 있을 때만 렌더 #}
  {% if stain %}
    {% if stain.not_to_do %}
      {% with todo=stain.not_to_do %}
        <ul class="avoid-list">
          {% if todo.0 and todo|length > 1 %}
            {% for t in todo %}
              <li class="avoid-item"><i class="fa-solid fa-circle-exclamation"></i><p class="preline">{{ t }}</p></li>
            {% endfor %}
          {% else %}
            <li class="avoid-item"><i class="fa-solid fa-circle-exclamation"></i><p class="preline">{{ todo }}</p></li>
          {% endif %}
        </ul>
      {% endwith %}
    {% elif stain.Not_to__do %}
      {% with todo=stain.Not_to__do %}
        <ul class="avoid-list">
          {% if todo.0 and todo|length > 1 %}
            {% for t in todo %}
              <li class="avoid-item"><i class="fa-solid fa-circle-exclamation"></i><p class="preline">{{ t }}</p></li>
            {% endfor %}
          {% else %}
            <li class="avoid-item"><i class="fa-solid fa-circle-exclamation"></i><p class="preline">{{ todo }}</p></li>
          {% endif %}
        </ul>
      {% endwith %}
    {% endif %}
  {% endif %}

  {# 3) 위 두 블록 모두 없을 때 기본 문구 (중첩 if 로 괄호 회피) #}
  {% if not material or not material.warning %}
    {% if not stain %}
      <div class="avoid-item"><p>특별히 피해야 할 항목이 없습니다.</p></div>
    {% elif not stain.not_to_do and not stain.Not_to__do %}
      <div class="avoid-item"><p>특별히 피해야 할 항목이 없습니다.</p></div>
    {% endif %}
  {% else %}
    {% if not stain %}
      <div class="avoid-item"><p>특별히 피해야 할 항목이 없습니다.</p></div>
    {% elif not stain.not_to_do and not stain.Not_to__do %}
      <div class="avoid-item"><p>특별히 피해야 할 항목이 없습니다.</p></div>
    {% endif %}
  {% endif %}
</section>



        <!-- 단계별 상세 가이드 -->
        <section class="card accordion-guide">
          <h3>단계별 상세 가이드</h3>

          <details class="accordion-item">
            <summary>
              <div class="summary-icon" style="background-color:#E8F0FE;">
                <i class="fa-solid fa-hand-sparkles" style="color:#4A6CFF;"></i>
              </div>
              <div class="summary-text">
                <h4>얼룩 제거 방법</h4>
                <p>{{ info.stains }}</p>
              </div>
              <i class="fa-solid fa-chevron-down arrow-icon"></i>
            </summary>
            <div class="accordion-content">
              {% if stain.Washing_Steps %}
                <ol class="step-list">
                  {% for step in stain.Washing_Steps %}
                    <li class="preline">{{ step }}</li>
                  {% endfor %}
                </ol>
              {% else %}
                <p>해당 얼룩의 단계별 가이드를 찾을 수 없습니다.</p>
              {% endif %}
            </div>
          </details>

          <details class="accordion-item">
            <summary>
              <div class="summary-icon" style="background-color:#E6F8F2;">
                <i class="fa-solid fa-lightbulb" style="color:#00BFA6;"></i>
              </div>
              <div class="summary-text">
                <h4>세탁 방법</h4>
                {% comment %} <p>{{ info.material|default:material.name }}</p> {% endcomment %}
                <p>
                {% if info.material %}
                  {{ info.material }}
                {% elif material %}
                  {{ material.name|default:"" }}
                {% else %}
                  (소재 미선택)
                {% endif %}
                {% if info.stains %} / {{ info.stains }}{% endif %}
                </p>

              </div>
              <i class="fa-solid fa-chevron-down arrow-icon"></i>
            </summary>
            <div class="accordion-content">
            <p>{{ material.description|default:"소재별 세탁 설명이 없습니다." }}</p>
            {% if washing_descriptions %}
            <ul>
                {% for desc in washing_descriptions %}
                <li>{{ desc }}</li>
                {% endfor %}
            </ul>
            {% elif symbols %}
            <ul>
                {% for desc in symbols %}
                <li>{{ desc }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            </div>
          </details>

          <details class="accordion-item">
            <summary>
              <div class="summary-icon" style="background-color:#FEF4E8;">
                <i class="fa-solid fa-droplet" style="color:#FF8A00"></i>
              </div>
              <div class="summary-text">
                <h4>건조 방법</h4>
                <p class="preline">{% if summary and summary.dry %}{{ summary.dry }}{% else %}정보 없음{% endif %}</p>
              </div>
              <i class="fa-solid fa-chevron-down arrow-icon"></i>
            </summary>
            <div class="accordion-content">
                <p>건조 방법에 대한 상세 내용은 추후 기호/소재 규칙을 확장해 채워집니다.</p>
                {% if drying_descriptions %}
                <ul>
                    {% for desc in drying_descriptions %}
                        <li>{{ desc }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
          </details>
        </section>

        <!-- 백과사전 -->
        
        <a href="{% url 'dictionary' %}" class="dictionary-link">
          <span>세탁 백과사전으로 가기</span>
          <i class="fa-solid fa-arrow-right"></i>
        </a>
      </main>
    </div>

    <nav class="bottom-nav">
      <a href="{% url 'main' %}" class="nav-item">
        <i class="fa-solid fa-house"></i>
        <span>메인 화면</span>
      </a>
      <a href="{% url 'map' %}" class="nav-item">
        <i class="fa-solid fa-map-location-dot"></i>
        <span>지도</span>
      </a>
      <a href="{% url 'laundry-upload' %}" class="nav-item-main">
        <i class="fa-solid fa-camera"></i>
      </a>
      <a href="{% url 'dictionary' %}" class="nav-item">
        <i class="fa-solid fa-book-open"></i>
        <span>백과사전</span>
      </a>
      <a href="{% url 'profile' %}" class="nav-item">
        <i class="fa-solid fa-gear"></i>
        <span>더보기</span>
      </a>
    </nav>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js"></script>
  <script type="module" src="{% static 'laundry_manager/laundry-info-script.js' %}"></script>
</body>
</html>
